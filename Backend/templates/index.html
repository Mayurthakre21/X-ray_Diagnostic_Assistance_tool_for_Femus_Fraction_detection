<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>X-Ray Analyzer</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-6">
    <div class="bg-white p-8 rounded-lg shadow-md w-full max-w-lg">
        <h1 class="text-2xl font-bold mb-4 text-center text-indigo-700">Doctor X-Ray Analyzer</h1>

        <input type="file" id="imageUpload" accept="image/*" class="w-full border border-gray-300 p-3 rounded mb-4">
        <img id="imagePreview" class="w-full mb-4 rounded hidden" style="max-height: 300px;" />

        <button id="submitBtn" class="w-full bg-indigo-600 text-white py-2 rounded hover:bg-indigo-700 transition">Analyze X-Ray</button>

        <div id="loading" class="text-center text-indigo-600 mt-4 hidden">Processing image...</div>

        <div class="mt-6">
            <h2 class="text-lg font-semibold mb-2">Result:</h2>
            <div id="result" class="bg-gray-100 p-4 rounded text-gray-800 whitespace-pre-wrap">No image uploaded yet.</div>
        </div>
    </div>

    <script>
    const imageUpload = document.getElementById('imageUpload');
    const imagePreview = document.getElementById('imagePreview');
    const submitBtn = document.getElementById('submitBtn');
    const resultBox = document.getElementById('result');
    const loading = document.getElementById('loading');

    imageUpload.addEventListener('change', () => {
        const file = imageUpload.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                imagePreview.src = e.target.result;
                imagePreview.classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        }
    });

    submitBtn.addEventListener('click', async () => {
        const file = imageUpload.files[0];
        if (!file) {
            resultBox.textContent = "Please select an image first.";
            return;
        }

        loading.classList.remove('hidden');
        resultBox.textContent = "";

        const formData = new FormData();
        formData.append("image", file);

        try {
            const response = await fetch("/upload", {
                method: "POST",
                body: formData
            });

            const data = await response.json();

            if (data.annotated_image) {
    imagePreview.src = data.annotated_image;
    imagePreview.classList.remove('hidden');
}

if (data.explanation) {
    resultBox.textContent = data.explanation;
} else if (data.error) {
    resultBox.textContent = "Error: " + data.error;
} else {
    resultBox.textContent = "Something went wrong.";
}


        } catch (error) {
            resultBox.textContent = "Error: " + error.message;
        } finally {
            loading.classList.add('hidden');
        }
    });
    </script>

</body>
</html>
